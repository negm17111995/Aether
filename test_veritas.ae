// Test all Veritas features
import std
import std.comptime.hw
import std.types.bounded
import std.actor.actor
import std.effects.effects

func main() -> Int {
    print(1000)  // Start marker
    
    // Test 1: Hardware-Aware Comptime
    let cpu = detect_cpu_arch()
    print(cpu)  // Should be 3 (Apple M)
    
    let simd = detect_simd_capability()
    print(simd)  // Should be 10 (NEON)
    
    // Test 2: Dependent Types (Bounded Array)
    let arr = bounded_new(5)
    bounded_push(arr, 10)
    bounded_push(arr, 20)
    bounded_push(arr, 30)
    let val = bounded_get(arr, 1)
    print(val)  // Should be 20
    
    // Test bounds enforcement
    let result = bounded_push(arr, 40)
    result = bounded_push(arr, 50)
    result = bounded_push(arr, 60)  // Should fail (capacity 5)
    print(result)  // Should be 0 (failed)
    
    // Test 3: Actor Model
    let sys = actor_system_new()
    let a1 = actor_system_spawn(sys, 0)
    let a2 = actor_system_spawn(sys, 0)
    actor_send(a1, 0, MSG_PING, 42)
    let msg = actor_receive(a1)
    if msg != 0 {
        print(1)  // Message received
    }
    
    // Test 4: Algebraic Effects
    let ctx = effect_ctx_new()
    let div_result = safe_div(ctx, 100, 5)
    print(div_result)  // Should be 20
    
    let bad_div = safe_div(ctx, 100, 0)  // Division by zero
    if effect_is_error(ctx) {
        print(999)  // Error detected
    }
    
    print(2000)  // End marker
    0
}
