// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AETHER WEB APP - "Todo Universe"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// A full-stack application in a SINGLE file.
// - Backend: Native HTTP Server + Database
// - Frontend: Reactive UI (compiled to WASM/JS automatically)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import std.web;
import std.db;
import std.ui;

// 1. DATA MODEL (Database Schema)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#[derive(Table, Serialize)]
struct Todo {
    #[primary_key] id: i64,
    title: str,
    completed: bool,
    created_at: Time,
}

// 2. BACKEND (API & Database)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
app Backend {
    // Native Database
    let db = AetherDB::open("todos.db");

    // API Routes (Simpler than Python/Go)
    @get("/api/todos")
    func list_todos() => db.query::<Todo>().all();

    @post("/api/todos")
    func add_todo(body: Todo) {
        db.insert(body);
        return status(201, "Created");
    }

    @put("/api/todos/:id")
    func toggle_todo(id: i64) {
        let todo = db.find::<Todo>(id);
        todo.completed = !todo.completed;
        db.update(todo);
    }
}

// 3. FRONTEND (Reactive UI)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
app Frontend {
    // State (Reactive by default)
    let todos = state(Backend.list_todos());
    let new_title = state("");

    // UI Components (Declarative)
    view Main {
        VStack {
            Text("Aether Todos")
                .font(.largeTitle)
                .color(.gradient(colors: [.blue, .purple]));

            // Input Field
            HStack {
                TextField("What needs doing?", text: $new_title)
                    .padding()
                    .background(.glass);

                Button("Add") {
                    Backend.add_todo(Todo { title: new_title, completed: false });
                    todos = Backend.list_todos(); // Auto-refresh state
                    new_title = "";
                }
                .keyboardShortcut(.defaultAction)
            }

            // List
            List(todos) { todo in
                HStack {
                    Toggle(isOn: $todo.completed)
                    Text(todo.title)
                        .strikethrough(todo.completed)
                }
                .onTap { Backend.toggle_todo(todo.id) }
                .animation(.spring)
            }
        }
        .padding()
        .theme(.dark) // Built-in Dark Mode
    }
}

// 4. ENTRY POINT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
func main() {
    print "ğŸš€ Aether Web App Running...";
    print "   Backend: http://localhost:8080";
    print "   Frontend: http://localhost:8080/ui";
    
    // In reality, this starts the native server
    // serve(Backend, Frontend, port: 8080);
}
