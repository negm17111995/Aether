// Test Energy Budget - REAL enforcement
import std
import std.energy.budget

func main() -> Int {
    // Create test data: [1, 2, 3, 4, 5]
    let data = ae_malloc(40)
    ae_store64(data, 1)
    ae_store64(data + 8, 2)
    ae_store64(data + 16, 3)
    ae_store64(data + 24, 4)
    ae_store64(data + 32, 5)
    
    // Sum with large budget (should complete)
    let budget1 = budget_new(10000)  // 10000 pJ
    let sum1 = sum_with_energy(data, 5, budget1)
    print(sum1)  // Expect: 15
    
    // Sum with tiny budget (should stop early)
    let budget2 = budget_new(100)  // Only 100 pJ
    let sum2 = sum_with_energy(data, 5, budget2)
    print(sum2)  // Expect: partial sum (less than 15)
    
    // Print energy spent
    let counter = budget_get_counter(budget1)
    let spent = energy_get_total(counter)
    print(spent)  // Total pJ used
    
    0
}
