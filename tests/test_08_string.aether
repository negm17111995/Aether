// TEST 8: String Operations
// Tests: string handling, char loading, length calculation

func str_len(s: Int) -> Int {
    let i = 0
    while __builtin_load8(s + i) != 0 {
        i = i + 1
    }
    i
}

func str_eq(a: Int, b: Int) -> Int {
    let i = 0
    while 1 == 1 {
        let ca = __builtin_load8(a + i)
        let cb = __builtin_load8(b + i)
        if ca != cb { return 0 }
        if ca == 0 { return 1 }
        i = i + 1
    }
    0
}

func str_copy(dst: Int, src: Int) {
    let i = 0
    while 1 == 1 {
        let c = __builtin_load8(src + i)
        __builtin_store8(dst + i, c)
        if c == 0 { return }
        i = i + 1
    }
}

func main() -> Int {
    // Create a string "hello"
    let s = __builtin_malloc(16)
    __builtin_store8(s, 104)     // h
    __builtin_store8(s + 1, 101) // e
    __builtin_store8(s + 2, 108) // l
    __builtin_store8(s + 3, 108) // l
    __builtin_store8(s + 4, 111) // o
    __builtin_store8(s + 5, 0)   // null
    
    // Test length
    let len = str_len(s)
    if len != 5 { return 1 }
    
    // Create copy
    let s2 = __builtin_malloc(16)
    str_copy(s2, s)
    
    // Check copy
    if str_len(s2) != 5 { return 2 }
    if str_eq(s, s2) != 1 { return 3 }
    
    // Check individual chars
    if __builtin_load8(s2) != 104 { return 4 }
    if __builtin_load8(s2 + 4) != 111 { return 5 }
    
    // Print "OK"
    print(79)
    print(75)
    print(10)
    0
}

func print(c: Int) {
    __builtin_print(c)
}
